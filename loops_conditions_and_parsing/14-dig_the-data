#!/usr/bin/env bash
# Skript apache-access.log faylını oxuyur, IP və HTTP status kodlarının sayını tapır
# və sayına görə azalan sırada göstərir.
# for, while, until, cut istifadə edilmir. Yalnız awk və sort istifadə olunur.

LOG_FILE="apache-access.log"

# Fayl yoxlanışı
if [[ ! -f "$LOG_FILE" ]]; then
    echo "Error: Log faylı tapılmadı" >&2
    exit 1
fi

awk '
    # Hər sətri yoxla, ən azı 9 sütun olmalıdır (IP 1-ci, status kod 9-cu sütun)
    NF >= 9 && $9 ~ /^[0-9]+$/ {
        count[$1,$9]++
    }
    END {
        for (key in count) {
            split(key, arr, SUBSEP)
            print count[key], arr[1], arr[2]
        }
    }
' "$LOG_FILE" | sort -rn


